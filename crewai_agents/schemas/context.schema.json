{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Master Normalized Context Schema",
  "description": "Schema for normalized context generated by Master Agent from a user one-liner.",
  "type": "object",
  "required": ["context"],
  "properties": {
    "context": {
      "type": "object",
      "required": [
        "intent",
        "molecule",
        "indication",
        "region",
        "year_range",
        "constraints"
      ],
      "properties": {
        "intent": {
          "type": "string",
          "description": "High-level intent inferred from user query (e.g., repurposing_analysis)."
        },

        "molecule": {
          "type": "object",
          "required": ["primary"],
          "properties": {
            "primary": {
              "type": "object",
              "required": ["inn"],
              "properties": {
                "inn": {
                  "type": "string",
                  "description": "Canonical INN or drug name."
                },
                "synonyms": {
                  "type": "array",
                  "description": "Known synonyms or brand names for the drug.",
                  "items": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": false
            },
            "comparators": {
              "type": "array",
              "description": "Optional comparator drugs.",
              "items": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },

        "indication": {
          "type": "object",
          "required": ["name"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Disease or condition name."
            },
            "codes": {
              "type": "object",
              "description": "Standard medical classification codes.",
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },

        "region": {
          "type": "string",
          "description": "Canonical country or region name."
        },

        "year_range": {
          "type": "array",
          "description": "Start and end year for evidence search.",
          "items": {
            "type": "integer"
          },
          "minItems": 2,
          "maxItems": 2
        },

        "dosage_form_hint": {
          "description": "Optional dosage form hint if provided.",
          "type": ["string", "null"]
        },

        "constraints": {
          "type": "object",
          "required": ["need_fto", "need_supply_view", "mvp_mode"],
          "properties": {
            "need_fto": {
              "type": "boolean",
              "description": "Whether freedom-to-operate analysis is required."
            },
            "need_supply_view": {
              "type": "boolean",
              "description": "Whether supply/exim analysis is required."
            },
            "mvp_mode": {
              "type": "boolean",
              "description": "Whether system is running in MVP/relaxed mode."
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
